/*******************************************************
   主板：Baize_ServoDriver_esp8266
   功能：UnderWaterHexapodRobot水下六足机器人Arduino程序
   引脚：SDA:21   SCL:22
   对于ARDUINO UNO，SCL:A5，SDA:A4
   Designer: Allen
   E-mail:953598974@qq.com
   Date:2022-08-22
*******************************************************/
#include <ESP8266WiFi.h>
#include <Wire.h>
#include <Adafruit_PWMServoDriver.h>
#define led 2
#define MAX_SRV_CLIENTS 3   //最大同时联接数，即你想要接入的设备数量，8266tcpserver只能接入五个

const char *ssid = "Baize"; 
const char *password = "baizerobot"; 

Adafruit_PWMServoDriver pwm = Adafruit_PWMServoDriver();               //驱动1~16或(0~15)号舵机
Adafruit_PWMServoDriver pwm1 = Adafruit_PWMServoDriver(0x41);          //驱动17~32或(16~31)号舵机

WiFiServer server(8266);//你要的端口号，随意修改，范围0-65535
WiFiClient serverClients[MAX_SRV_CLIENTS];

//#define SERVOMIN  102               //0.5/20 * 4096 = 102
//#define SERVOMID  307               //1.5/20 * 4096 = 307
//#define SERVOMAX  512               //2.5/20 * 4096 = 512
//实际测试
#define SERVOMIN  102               
#define SERVOMID  327               
#define SERVOMAX  552

//pwm.setPWM(i, 0, pulselen);第一个参数是通道数;第二个是高电平起始点，也就是从0开始;第三个参数是高电平终止点。

char cmd = 'e';//a:forward;   b:backward;   c:left;   d:right;   e:stop;
int rec[18] = {
  320,320,327,
  327,345,310,
  350,327,310,
  350,327,337,
  327,327,350,
  350,340,320
};
int direct[18] = {-1,1,1,
-1,1,1,
-1,1,1,
-1,1,1,
-1,1,1,
-1,1,1
};

float forward[40][18] = {
16.11,-45.44,-44.11,-12.33,-44.23,-39.34,-16.30,-45.17,-48.35,16.11,-44.95,-43.75,-12.33,-44.68,-39.67,-16.30,-44.64,-47.97,
15.94,-46.87,-45.17,-12.21,-44.25,-39.42,-16.10,-46.72,-49.45,15.94,-44.96,-43.78,-12.21,-46.03,-40.72,-16.10,-44.65,-47.95,
15.49,-49.16,-46.88,-11.90,-44.30,-39.63,-15.56,-49.21,-51.17,15.49,-44.96,-43.85,-11.90,-48.20,-42.44,-15.56,-44.66,-47.90,
14.64,-52.16,-49.12,-11.31,-44.38,-40.00,-14.59,-52.48,-53.36,14.64,-44.97,-43.98,-11.31,-51.06,-44.78,-14.59,-44.69,-47.79,
13.32,-55.68,-51.72,-10.39,-44.50,-40.56,-13.09,-56.30,-55.79,13.32,-44.98,-44.16,-10.39,-54.44,-47.61,-13.09,-44.73,-47.62,
11.49,-59.42,-54.47,-9.08,-44.64,-41.30,-11.09,-60.33,-58.20,11.49,-44.99,-44.38,-9.08,-58.11,-50.75,-11.09,-44.79,-47.36,
9.16,-63.06,-57.11,-7.37,-44.78,-42.18,-8.64,-64.12,-60.28,9.16,-45.00,-44.61,-7.37,-61.79,-53.98,-8.64,-44.85,-46.98,
6.39,-66.16,-59.33,-5.25,-44.90,-43.13,-5.87,-67.13,-61.67,6.39,-45.00,-44.81,-5.25,-65.12,-57.03,-5.87,-44.92,-46.46,
3.29,-68.27,-60.83,-2.77,-44.97,-44.09,-2.93,-68.86,-62.08,3.29,-45.00,-44.95,-2.77,-67.67,-59.60,-2.93,-44.98,-45.80,
-0.00,-69.02,-61.36,0.00,-45.00,-45.00,-0.00,-69.02,-61.36,-0.00,-45.00,-45.00,0.00,-69.02,-61.36,-0.00,-45.00,-45.00,
-3.29,-68.27,-60.83,2.93,-44.98,-45.80,2.77,-67.67,-59.60,-3.29,-45.00,-44.95,2.93,-68.86,-62.08,2.77,-44.97,-44.09,
-6.39,-66.16,-59.33,5.87,-44.92,-46.46,5.25,-65.12,-57.03,-6.39,-45.00,-44.81,5.87,-67.13,-61.67,5.25,-44.90,-43.13,
-9.16,-63.06,-57.11,8.64,-44.85,-46.98,7.37,-61.79,-53.98,-9.16,-45.00,-44.61,8.64,-64.12,-60.28,7.37,-44.78,-42.18,
-11.49,-59.42,-54.47,11.09,-44.79,-47.36,9.08,-58.12,-50.75,-11.49,-44.99,-44.38,11.09,-60.33,-58.20,9.08,-44.64,-41.30,
-13.32,-55.68,-51.72,13.09,-44.73,-47.62,10.39,-54.44,-47.61,-13.32,-44.98,-44.16,13.09,-56.30,-55.79,10.39,-44.50,-40.56,
-14.64,-52.16,-49.12,14.59,-44.69,-47.79,11.31,-51.06,-44.78,-14.64,-44.97,-43.98,14.59,-52.48,-53.36,11.31,-44.38,-40.00,
-15.49,-49.16,-46.88,15.56,-44.66,-47.90,11.90,-48.20,-42.44,-15.49,-44.96,-43.85,15.56,-49.21,-51.17,11.90,-44.30,-39.63,
-15.94,-46.87,-45.17,16.10,-44.65,-47.95,12.21,-46.03,-40.72,-15.94,-44.96,-43.78,16.10,-46.72,-49.45,12.21,-44.25,-39.42,
-16.11,-45.44,-44.11,16.30,-44.64,-47.97,12.33,-44.69,-39.67,-16.11,-44.95,-43.75,16.30,-45.17,-48.35,12.33,-44.23,-39.34,
-16.14,-44.95,-43.75,16.33,-44.64,-47.97,12.35,-44.23,-39.33,-16.14,-44.95,-43.75,16.33,-44.64,-47.97,12.35,-44.23,-39.33,
-16.11,-44.95,-43.75,16.30,-45.17,-48.35,12.33,-44.23,-39.34,-16.11,-45.44,-44.11,16.30,-44.64,-47.97,12.33,-44.68,-39.67,
-15.94,-44.96,-43.78,16.10,-46.72,-49.45,12.21,-44.25,-39.42,-15.94,-46.87,-45.17,16.10,-44.65,-47.95,12.21,-46.03,-40.72,
-15.49,-44.96,-43.85,15.56,-49.21,-51.17,11.90,-44.30,-39.63,-15.49,-49.16,-46.88,15.56,-44.66,-47.90,11.90,-48.20,-42.44,
-14.64,-44.97,-43.98,14.59,-52.48,-53.36,11.31,-44.38,-40.00,-14.64,-52.16,-49.12,14.59,-44.69,-47.79,11.31,-51.06,-44.78,
-13.32,-44.98,-44.16,13.09,-56.30,-55.79,10.39,-44.50,-40.56,-13.32,-55.68,-51.72,13.09,-44.73,-47.62,10.39,-54.44,-47.61,
-11.49,-44.99,-44.38,11.09,-60.33,-58.20,9.08,-44.64,-41.30,-11.49,-59.42,-54.47,11.09,-44.79,-47.36,9.08,-58.11,-50.75,
-9.16,-45.00,-44.61,8.64,-64.12,-60.28,7.37,-44.78,-42.18,-9.16,-63.06,-57.11,8.64,-44.85,-46.98,7.37,-61.79,-53.98,
-6.39,-45.00,-44.81,5.87,-67.13,-61.67,5.25,-44.90,-43.13,-6.39,-66.16,-59.33,5.87,-44.92,-46.46,5.25,-65.12,-57.03,
-3.29,-45.00,-44.95,2.93,-68.86,-62.08,2.77,-44.97,-44.09,-3.29,-68.27,-60.83,2.93,-44.98,-45.80,2.77,-67.67,-59.60,
0.00,-45.00,-45.00,0.00,-69.02,-61.36,-0.00,-45.00,-45.00,-0.00,-69.02,-61.36,0.00,-45.00,-45.00,-0.00,-69.02,-61.36,
3.29,-45.00,-44.95,-2.77,-67.67,-59.60,-2.93,-44.98,-45.80,3.29,-68.27,-60.83,-2.77,-44.97,-44.09,-2.93,-68.86,-62.08,
6.39,-45.00,-44.81,-5.25,-65.12,-57.03,-5.87,-44.92,-46.46,6.39,-66.16,-59.33,-5.25,-44.90,-43.13,-5.87,-67.13,-61.67,
9.16,-45.00,-44.61,-7.37,-61.79,-53.98,-8.64,-44.85,-46.98,9.16,-63.06,-57.11,-7.37,-44.78,-42.18,-8.64,-64.12,-60.28,
11.49,-44.99,-44.38,-9.08,-58.11,-50.75,-11.09,-44.79,-47.36,11.49,-59.42,-54.47,-9.08,-44.64,-41.30,-11.09,-60.33,-58.20,
13.32,-44.98,-44.16,-10.39,-54.44,-47.61,-13.09,-44.73,-47.62,13.32,-55.68,-51.72,-10.39,-44.50,-40.56,-13.09,-56.30,-55.79,
14.64,-44.97,-43.98,-11.31,-51.06,-44.78,-14.59,-44.69,-47.79,14.64,-52.16,-49.12,-11.31,-44.38,-40.00,-14.59,-52.48,-53.36,
15.49,-44.96,-43.85,-11.90,-48.20,-42.44,-15.56,-44.66,-47.90,15.49,-49.16,-46.88,-11.90,-44.30,-39.63,-15.56,-49.21,-51.17,
15.94,-44.96,-43.78,-12.21,-46.03,-40.72,-16.10,-44.65,-47.95,15.94,-46.87,-45.17,-12.21,-44.25,-39.42,-16.10,-46.72,-49.45,
16.11,-44.95,-43.75,-12.33,-44.68,-39.67,-16.30,-44.64,-47.97,16.11,-45.44,-44.11,-12.33,-44.23,-39.34,-16.30,-45.17,-48.35,
16.14,-44.95,-43.75,-12.35,-44.23,-39.33,-16.33,-44.64,-47.97,16.14,-44.95,-43.75,-12.35,-44.23,-39.33,-16.33,-44.64,-47.97
};

float forwardF[120][18] = {
16.11,-45.44,-44.11,-7.87,-44.74,-41.93,-9.36,-44.84,-47.09,3.31,-45.00,-44.95,-2.79,-44.97,-44.08,-16.32,-44.64,-47.97,
15.94,-46.87,-45.17,-7.85,-44.75,-41.94,-9.39,-44.83,-47.10,3.27,-45.00,-44.95,-2.82,-44.97,-44.07,-16.28,-44.64,-47.97,
15.49,-49.16,-46.88,-7.78,-44.75,-41.98,-9.49,-44.83,-47.12,3.17,-45.00,-44.95,-2.90,-44.97,-44.04,-16.18,-44.65,-47.96,
14.64,-52.16,-49.12,-7.64,-44.76,-42.04,-9.68,-44.83,-47.15,2.99,-45.00,-44.96,-3.05,-44.97,-43.99,-15.98,-44.65,-47.94,
13.32,-55.68,-51.72,-7.44,-44.78,-42.14,-9.96,-44.82,-47.19,2.71,-45.00,-44.97,-3.28,-44.96,-43.91,-15.67,-44.66,-47.91,
11.49,-59.42,-54.47,-7.16,-44.80,-42.28,-10.35,-44.81,-47.25,2.33,-45.00,-44.98,-3.59,-44.96,-43.79,-15.26,-44.67,-47.87,
9.16,-63.06,-57.11,-6.81,-44.82,-42.44,-10.85,-44.79,-47.32,1.85,-45.00,-44.99,-3.97,-44.95,-43.65,-14.74,-44.69,-47.81,
6.39,-66.16,-59.33,-6.39,-44.84,-42.64,-11.43,-44.78,-47.40,1.28,-45.00,-44.99,-4.42,-44.93,-43.47,-14.14,-44.70,-47.74,
3.29,-68.27,-60.83,-5.91,-44.87,-42.85,-12.08,-44.76,-47.49,0.66,-45.00,-45.00,-4.91,-44.91,-43.27,-13.47,-44.72,-47.67,
-0.00,-69.02,-61.36,-5.41,-44.89,-43.06,-12.77,-44.74,-47.58,0.00,-45.00,-45.00,-5.41,-44.89,-43.06,-12.77,-44.74,-47.58,
-3.29,-68.27,-60.83,-4.91,-44.91,-43.27,-13.47,-44.72,-47.67,-0.66,-45.00,-45.00,-5.91,-44.87,-42.85,-12.08,-44.76,-47.49,
-6.39,-66.16,-59.33,-4.42,-44.93,-43.47,-14.14,-44.70,-47.74,-1.28,-45.00,-44.99,-6.39,-44.84,-42.64,-11.43,-44.78,-47.40,
-9.16,-63.06,-57.11,-3.97,-44.95,-43.65,-14.74,-44.69,-47.81,-1.85,-45.00,-44.99,-6.81,-44.82,-42.44,-10.85,-44.79,-47.32,
-11.49,-59.42,-54.47,-3.59,-44.96,-43.79,-15.26,-44.67,-47.86,-2.33,-45.00,-44.98,-7.16,-44.80,-42.28,-10.35,-44.81,-47.25,
-13.32,-55.68,-51.72,-3.28,-44.96,-43.91,-15.67,-44.66,-47.91,-2.71,-45.00,-44.97,-7.44,-44.78,-42.14,-9.96,-44.82,-47.19,
-14.64,-52.16,-49.12,-3.05,-44.97,-43.99,-15.98,-44.65,-47.94,-2.99,-45.00,-44.96,-7.64,-44.76,-42.04,-9.68,-44.83,-47.15,
-15.49,-49.16,-46.88,-2.90,-44.97,-44.04,-16.18,-44.65,-47.96,-3.17,-45.00,-44.95,-7.78,-44.75,-41.98,-9.49,-44.83,-47.12,
-15.94,-46.87,-45.17,-2.82,-44.97,-44.07,-16.28,-44.64,-47.97,-3.27,-45.00,-44.95,-7.85,-44.75,-41.94,-9.39,-44.83,-47.10,
-16.11,-45.44,-44.11,-2.79,-44.97,-44.08,-16.32,-44.64,-47.97,-3.31,-45.00,-44.95,-7.87,-44.74,-41.93,-9.36,-44.84,-47.09,
-16.14,-44.95,-43.75,-2.79,-44.97,-44.09,-16.33,-44.64,-47.97,-3.31,-45.00,-44.95,-7.88,-44.74,-41.93,-9.35,-44.84,-47.09,
-16.14,-44.95,-43.75,-2.78,-44.97,-44.09,-16.30,-45.17,-48.35,-3.32,-45.00,-44.95,-7.88,-44.74,-41.93,-9.34,-44.84,-47.09,
-16.10,-44.95,-43.75,-2.75,-44.98,-44.10,-16.10,-46.72,-49.45,-3.35,-45.00,-44.95,-7.91,-44.74,-41.91,-9.31,-44.84,-47.09,
-16.01,-44.95,-43.77,-2.67,-44.98,-44.13,-15.56,-49.21,-51.17,-3.45,-45.00,-44.95,-7.98,-44.74,-41.88,-9.21,-44.84,-47.07,
-15.84,-44.96,-43.80,-2.52,-44.98,-44.18,-14.59,-52.48,-53.36,-3.63,-45.00,-44.94,-8.11,-44.73,-41.81,-9.02,-44.84,-47.04,
-15.58,-44.96,-43.84,-2.29,-44.98,-44.26,-13.09,-56.30,-55.79,-3.91,-45.00,-44.93,-8.31,-44.71,-41.71,-8.74,-44.85,-46.99,
-15.23,-44.96,-43.89,-1.98,-44.99,-44.37,-11.09,-60.33,-58.20,-4.29,-45.00,-44.92,-8.58,-44.69,-41.57,-8.36,-44.86,-46.93,
-14.78,-44.97,-43.96,-1.58,-44.99,-44.50,-8.64,-64.12,-60.28,-4.77,-45.00,-44.90,-8.92,-44.66,-41.39,-7.88,-44.87,-46.84,
-14.25,-44.97,-44.04,-1.10,-45.00,-44.66,-5.87,-67.13,-61.67,-5.33,-45.00,-44.87,-9.31,-44.62,-41.18,-7.32,-44.89,-46.74,
-13.66,-44.98,-44.12,-0.57,-45.00,-44.83,-2.93,-68.86,-62.08,-5.95,-45.00,-44.84,-9.74,-44.57,-40.94,-6.71,-44.90,-46.63,
-13.03,-44.98,-44.20,0.00,-45.00,-45.00,-0.00,-69.02,-61.36,-6.60,-45.00,-44.80,-10.19,-44.53,-40.68,-6.07,-44.92,-46.50,
-12.41,-44.98,-44.28,0.57,-45.00,-45.17,2.77,-67.67,-59.60,-7.25,-45.00,-44.76,-10.63,-44.47,-40.42,-5.44,-44.93,-46.37,
-11.81,-44.99,-44.35,1.12,-45.00,-45.32,5.25,-65.12,-57.03,-7.87,-45.00,-44.72,-11.04,-44.42,-40.17,-4.85,-44.95,-46.24,
-11.27,-44.99,-44.41,1.63,-44.99,-45.46,7.37,-61.79,-53.98,-8.42,-45.00,-44.68,-11.41,-44.37,-39.94,-4.31,-44.96,-46.13,
-10.80,-44.99,-44.46,2.06,-44.99,-45.58,9.08,-58.12,-50.75,-8.89,-45.00,-44.64,-11.72,-44.33,-39.74,-3.86,-44.96,-46.02,
-10.43,-44.99,-44.50,2.40,-44.99,-45.67,10.39,-54.44,-47.61,-9.26,-45.00,-44.60,-11.97,-44.29,-39.58,-3.51,-44.97,-45.94,
-10.16,-44.99,-44.52,2.66,-44.98,-45.73,11.31,-51.06,-44.78,-9.54,-44.99,-44.58,-12.14,-44.26,-39.47,-3.25,-44.97,-45.88,
-9.99,-44.99,-44.54,2.83,-44.98,-45.77,11.90,-48.20,-42.45,-9.71,-44.99,-44.56,-12.26,-44.24,-39.39,-3.08,-44.98,-45.84,
-9.89,-44.99,-44.55,2.92,-44.98,-45.80,12.21,-46.03,-40.72,-9.81,-44.99,-44.56,-12.32,-44.23,-39.35,-2.99,-44.98,-45.81,
-9.85,-44.99,-44.55,2.95,-44.98,-45.80,12.33,-44.69,-39.67,-9.84,-44.99,-44.55,-12.35,-44.23,-39.33,-2.96,-44.98,-45.81,
-9.85,-44.99,-44.55,2.95,-44.98,-45.80,12.35,-44.23,-39.33,-9.85,-44.99,-44.55,-12.35,-44.23,-39.33,-2.95,-44.98,-45.80,
-9.84,-44.99,-44.55,2.96,-44.98,-45.81,12.35,-44.23,-39.33,-9.85,-44.99,-44.55,-12.33,-44.68,-39.67,-2.95,-44.98,-45.80,
-9.81,-44.99,-44.56,2.99,-44.98,-45.81,12.32,-44.23,-39.35,-9.89,-44.99,-44.55,-12.21,-46.03,-40.72,-2.92,-44.98,-45.80,
-9.71,-44.99,-44.56,3.08,-44.98,-45.84,12.26,-44.24,-39.39,-9.99,-44.99,-44.54,-11.90,-48.20,-42.44,-2.83,-44.98,-45.77,
-9.54,-44.99,-44.58,3.25,-44.97,-45.88,12.14,-44.26,-39.47,-10.16,-44.99,-44.52,-11.31,-51.06,-44.78,-2.66,-44.98,-45.73,
-9.26,-45.00,-44.60,3.51,-44.97,-45.94,11.97,-44.29,-39.58,-10.43,-44.99,-44.50,-10.39,-54.44,-47.61,-2.40,-44.99,-45.67,
-8.89,-45.00,-44.64,3.86,-44.96,-46.02,11.72,-44.33,-39.74,-10.80,-44.99,-44.46,-9.08,-58.11,-50.75,-2.06,-44.99,-45.58,
-8.42,-45.00,-44.68,4.31,-44.96,-46.13,11.41,-44.37,-39.94,-11.27,-44.99,-44.41,-7.37,-61.79,-53.98,-1.63,-44.99,-45.46,
-7.87,-45.00,-44.72,4.85,-44.95,-46.24,11.04,-44.42,-40.17,-11.81,-44.99,-44.35,-5.25,-65.12,-57.03,-1.12,-45.00,-45.32,
-7.25,-45.00,-44.76,5.44,-44.93,-46.37,10.63,-44.47,-40.42,-12.41,-44.98,-44.28,-2.77,-67.67,-59.60,-0.57,-45.00,-45.17,
-6.60,-45.00,-44.80,6.07,-44.92,-46.50,10.19,-44.53,-40.68,-13.03,-44.98,-44.20,0.00,-69.02,-61.36,-0.00,-45.00,-45.00,
-5.95,-45.00,-44.84,6.71,-44.90,-46.63,9.74,-44.57,-40.94,-13.66,-44.98,-44.12,2.93,-68.86,-62.08,0.57,-45.00,-44.83,
-5.33,-45.00,-44.87,7.32,-44.89,-46.74,9.31,-44.62,-41.18,-14.25,-44.97,-44.04,5.87,-67.13,-61.67,1.10,-45.00,-44.66,
-4.77,-45.00,-44.90,7.88,-44.87,-46.84,8.92,-44.66,-41.39,-14.78,-44.97,-43.96,8.64,-64.12,-60.28,1.58,-44.99,-44.50,
-4.29,-45.00,-44.92,8.36,-44.86,-46.93,8.58,-44.69,-41.57,-15.23,-44.96,-43.89,11.09,-60.33,-58.20,1.98,-44.99,-44.37,
-3.91,-45.00,-44.93,8.74,-44.85,-46.99,8.31,-44.71,-41.71,-15.58,-44.96,-43.84,13.09,-56.30,-55.79,2.30,-44.98,-44.26,
-3.63,-45.00,-44.94,9.02,-44.84,-47.04,8.11,-44.73,-41.81,-15.84,-44.96,-43.80,14.59,-52.48,-53.36,2.53,-44.98,-44.18,
-3.45,-45.00,-44.95,9.21,-44.84,-47.07,7.98,-44.74,-41.88,-16.01,-44.95,-43.77,15.56,-49.21,-51.17,2.67,-44.98,-44.13,
-3.35,-45.00,-44.95,9.31,-44.84,-47.09,7.91,-44.74,-41.91,-16.10,-44.95,-43.75,16.10,-46.72,-49.45,2.75,-44.98,-44.10,
-3.32,-45.00,-44.95,9.34,-44.84,-47.09,7.88,-44.74,-41.93,-16.13,-44.95,-43.75,16.30,-45.17,-48.35,2.78,-44.97,-44.09,
-3.31,-45.00,-44.95,9.35,-44.84,-47.09,7.88,-44.74,-41.93,-16.14,-44.95,-43.75,16.33,-44.64,-47.97,2.79,-44.97,-44.09,
-3.31,-45.00,-44.95,9.36,-44.84,-47.09,7.87,-44.74,-41.93,-16.11,-45.44,-44.11,16.33,-44.64,-47.97,2.79,-44.97,-44.08,
-3.27,-45.00,-44.95,9.39,-44.83,-47.10,7.85,-44.75,-41.94,-15.94,-46.87,-45.17,16.28,-44.64,-47.97,2.82,-44.97,-44.07,
-3.17,-45.00,-44.95,9.49,-44.83,-47.12,7.78,-44.75,-41.98,-15.49,-49.16,-46.88,16.18,-44.65,-47.96,2.90,-44.97,-44.04,
-2.99,-45.00,-44.96,9.68,-44.83,-47.14,7.64,-44.76,-42.04,-14.64,-52.16,-49.12,15.98,-44.65,-47.94,3.05,-44.97,-43.99,
-2.71,-45.00,-44.97,9.96,-44.82,-47.19,7.44,-44.78,-42.14,-13.32,-55.68,-51.72,15.67,-44.66,-47.91,3.28,-44.96,-43.91,
-2.33,-45.00,-44.98,10.35,-44.81,-47.25,7.16,-44.80,-42.28,-11.49,-59.42,-54.47,15.26,-44.67,-47.87,3.59,-44.96,-43.79,
-1.85,-45.00,-44.99,10.85,-44.79,-47.32,6.81,-44.82,-42.44,-9.16,-63.06,-57.11,14.74,-44.69,-47.81,3.97,-44.95,-43.65,
-1.28,-45.00,-44.99,11.43,-44.78,-47.40,6.39,-44.84,-42.64,-6.39,-66.16,-59.33,14.14,-44.70,-47.74,4.42,-44.93,-43.47,
-0.66,-45.00,-45.00,12.08,-44.76,-47.49,5.91,-44.87,-42.85,-3.29,-68.27,-60.83,13.47,-44.72,-47.67,4.91,-44.91,-43.27,
-0.00,-45.00,-45.00,12.77,-44.74,-47.58,5.41,-44.89,-43.06,-0.00,-69.02,-61.36,12.77,-44.74,-47.58,5.41,-44.89,-43.06,
0.66,-45.00,-45.00,13.47,-44.72,-47.67,4.91,-44.91,-43.27,3.29,-68.27,-60.83,12.08,-44.76,-47.49,5.91,-44.87,-42.85,
1.28,-45.00,-44.99,14.14,-44.70,-47.74,4.42,-44.93,-43.47,6.39,-66.16,-59.33,11.43,-44.78,-47.40,6.39,-44.84,-42.64,
1.85,-45.00,-44.99,14.74,-44.69,-47.81,3.97,-44.95,-43.65,9.16,-63.06,-57.11,10.85,-44.79,-47.32,6.81,-44.82,-42.44,
2.33,-45.00,-44.98,15.26,-44.67,-47.86,3.59,-44.96,-43.79,11.49,-59.42,-54.47,10.35,-44.81,-47.25,7.16,-44.80,-42.28,
2.71,-45.00,-44.97,15.67,-44.66,-47.91,3.28,-44.96,-43.91,13.32,-55.68,-51.72,9.96,-44.82,-47.19,7.44,-44.78,-42.14,
2.99,-45.00,-44.96,15.98,-44.65,-47.94,3.05,-44.97,-43.99,14.64,-52.16,-49.12,9.68,-44.83,-47.15,7.64,-44.76,-42.04,
3.17,-45.00,-44.95,16.18,-44.65,-47.96,2.90,-44.97,-44.04,15.49,-49.16,-46.88,9.49,-44.83,-47.12,7.78,-44.75,-41.98,
3.27,-45.00,-44.95,16.28,-44.64,-47.97,2.82,-44.97,-44.07,15.94,-46.87,-45.17,9.39,-44.83,-47.10,7.85,-44.75,-41.94,
3.31,-45.00,-44.95,16.32,-44.64,-47.97,2.79,-44.97,-44.08,16.11,-45.44,-44.11,9.36,-44.84,-47.09,7.87,-44.74,-41.93,
3.31,-45.00,-44.95,16.33,-44.64,-47.97,2.79,-44.97,-44.09,16.14,-44.95,-43.75,9.35,-44.84,-47.09,7.88,-44.74,-41.93,
3.32,-45.00,-44.95,16.30,-45.17,-48.35,2.78,-44.97,-44.09,16.14,-44.95,-43.75,9.34,-44.84,-47.09,7.88,-44.74,-41.93,
3.35,-45.00,-44.95,16.10,-46.72,-49.45,2.75,-44.98,-44.10,16.10,-44.95,-43.75,9.31,-44.84,-47.09,7.91,-44.74,-41.91,
3.45,-45.00,-44.95,15.56,-49.21,-51.17,2.67,-44.98,-44.13,16.01,-44.95,-43.77,9.21,-44.84,-47.07,7.98,-44.74,-41.88,
3.63,-45.00,-44.94,14.59,-52.48,-53.36,2.52,-44.98,-44.18,15.84,-44.96,-43.80,9.02,-44.84,-47.04,8.11,-44.73,-41.81,
3.91,-45.00,-44.93,13.09,-56.30,-55.79,2.29,-44.98,-44.26,15.58,-44.96,-43.84,8.74,-44.85,-46.99,8.31,-44.71,-41.71,
4.29,-45.00,-44.92,11.09,-60.33,-58.20,1.98,-44.99,-44.37,15.23,-44.96,-43.89,8.36,-44.86,-46.93,8.58,-44.69,-41.57,
4.77,-45.00,-44.90,8.64,-64.12,-60.28,1.58,-44.99,-44.50,14.78,-44.97,-43.96,7.88,-44.87,-46.84,8.92,-44.66,-41.39,
5.33,-45.00,-44.87,5.87,-67.12,-61.67,1.10,-45.00,-44.66,14.25,-44.97,-44.04,7.32,-44.89,-46.74,9.31,-44.62,-41.18,
5.95,-45.00,-44.84,2.93,-68.86,-62.08,0.57,-45.00,-44.83,13.66,-44.98,-44.12,6.71,-44.90,-46.63,9.74,-44.57,-40.94,
6.60,-45.00,-44.80,0.00,-69.02,-61.36,-0.00,-45.00,-45.00,13.03,-44.98,-44.20,6.07,-44.92,-46.50,10.19,-44.53,-40.68,
7.25,-45.00,-44.76,-2.77,-67.67,-59.60,-0.57,-45.00,-45.17,12.41,-44.98,-44.28,5.44,-44.93,-46.37,10.63,-44.47,-40.42,
7.87,-45.00,-44.72,-5.25,-65.12,-57.03,-1.12,-45.00,-45.32,11.81,-44.99,-44.35,4.85,-44.95,-46.24,11.04,-44.42,-40.17,
8.42,-45.00,-44.68,-7.37,-61.79,-53.98,-1.63,-44.99,-45.46,11.27,-44.99,-44.41,4.31,-44.96,-46.13,11.41,-44.37,-39.94,
8.89,-45.00,-44.64,-9.08,-58.11,-50.75,-2.06,-44.99,-45.58,10.80,-44.99,-44.46,3.86,-44.96,-46.02,11.72,-44.33,-39.74,
9.26,-45.00,-44.60,-10.39,-54.44,-47.61,-2.40,-44.99,-45.67,10.43,-44.99,-44.50,3.51,-44.97,-45.94,11.97,-44.29,-39.58,
9.54,-44.99,-44.58,-11.31,-51.06,-44.78,-2.66,-44.98,-45.73,10.16,-44.99,-44.52,3.25,-44.97,-45.88,12.14,-44.26,-39.47,
9.71,-44.99,-44.56,-11.90,-48.20,-42.44,-2.83,-44.98,-45.77,9.99,-44.99,-44.54,3.08,-44.98,-45.84,12.26,-44.24,-39.39,
9.81,-44.99,-44.56,-12.21,-46.03,-40.72,-2.92,-44.98,-45.80,9.89,-44.99,-44.55,2.99,-44.98,-45.81,12.32,-44.23,-39.35,
9.84,-44.99,-44.55,-12.33,-44.68,-39.67,-2.95,-44.98,-45.80,9.85,-44.99,-44.55,2.96,-44.98,-45.81,12.35,-44.23,-39.33,
9.85,-44.99,-44.55,-12.35,-44.23,-39.33,-2.95,-44.98,-45.80,9.85,-44.99,-44.55,2.95,-44.98,-45.80,12.35,-44.23,-39.33,
9.85,-44.99,-44.55,-12.35,-44.23,-39.33,-2.96,-44.98,-45.81,9.84,-44.99,-44.55,2.95,-44.98,-45.80,12.33,-44.68,-39.67,
9.89,-44.99,-44.55,-12.32,-44.23,-39.35,-2.99,-44.98,-45.81,9.81,-44.99,-44.56,2.92,-44.98,-45.80,12.21,-46.03,-40.72,
9.99,-44.99,-44.54,-12.26,-44.24,-39.39,-3.08,-44.98,-45.84,9.71,-44.99,-44.56,2.83,-44.98,-45.77,11.90,-48.20,-42.44,
10.16,-44.99,-44.52,-12.14,-44.26,-39.47,-3.25,-44.97,-45.88,9.54,-44.99,-44.58,2.66,-44.98,-45.73,11.31,-51.06,-44.78,
10.43,-44.99,-44.50,-11.97,-44.29,-39.58,-3.51,-44.97,-45.94,9.26,-45.00,-44.60,2.40,-44.99,-45.67,10.39,-54.44,-47.61,
10.80,-44.99,-44.46,-11.72,-44.33,-39.74,-3.86,-44.96,-46.02,8.89,-45.00,-44.64,2.06,-44.99,-45.58,9.08,-58.11,-50.75,
11.27,-44.99,-44.41,-11.41,-44.37,-39.94,-4.31,-44.96,-46.13,8.42,-45.00,-44.68,1.63,-44.99,-45.46,7.37,-61.79,-53.98,
11.81,-44.99,-44.35,-11.04,-44.42,-40.17,-4.85,-44.95,-46.24,7.87,-45.00,-44.72,1.12,-45.00,-45.32,5.25,-65.12,-57.03,
12.41,-44.98,-44.28,-10.63,-44.47,-40.42,-5.44,-44.93,-46.37,7.25,-44.99,-44.75,0.57,-45.00,-45.17,2.77,-67.67,-59.60,
13.03,-44.98,-44.20,-10.19,-44.53,-40.68,-6.07,-44.92,-46.50,6.60,-45.00,-44.80,0.00,-45.00,-45.00,-0.00,-69.02,-61.36,
13.66,-44.98,-44.12,-9.74,-44.57,-40.94,-6.71,-44.90,-46.63,5.95,-45.00,-44.84,-0.57,-45.00,-44.83,-2.93,-68.86,-62.08,
14.25,-44.97,-44.04,-9.31,-44.62,-41.18,-7.32,-44.89,-46.74,5.33,-45.00,-44.87,-1.10,-45.00,-44.66,-5.87,-67.13,-61.67,
14.78,-44.97,-43.96,-8.92,-44.66,-41.39,-7.88,-44.87,-46.84,4.77,-45.00,-44.90,-1.58,-44.99,-44.51,-8.64,-64.12,-60.28,
15.23,-44.96,-43.89,-8.58,-44.69,-41.57,-8.36,-44.86,-46.93,4.29,-45.00,-44.92,-1.98,-44.99,-44.37,-11.09,-60.33,-58.20,
15.58,-44.96,-43.84,-8.31,-44.71,-41.71,-8.74,-44.85,-46.99,3.91,-45.00,-44.93,-2.30,-44.98,-44.26,-13.09,-56.30,-55.79,
15.84,-44.96,-43.80,-8.11,-44.73,-41.81,-9.02,-44.84,-47.04,3.63,-45.00,-44.94,-2.53,-44.98,-44.18,-14.59,-52.48,-53.36,
16.01,-44.95,-43.77,-7.98,-44.74,-41.88,-9.21,-44.84,-47.07,3.45,-45.00,-44.95,-2.67,-44.98,-44.13,-15.56,-49.20,-51.17,
16.10,-44.95,-43.75,-7.91,-44.74,-41.91,-9.31,-44.84,-47.09,3.35,-45.00,-44.95,-2.75,-44.98,-44.10,-16.10,-46.72,-49.45,
16.13,-44.95,-43.75,-7.88,-44.74,-41.93,-9.34,-44.84,-47.09,3.32,-45.00,-44.95,-2.78,-44.97,-44.09,-16.30,-45.17,-48.35,
16.14,-44.95,-43.75,-7.88,-44.74,-41.93,-9.35,-44.84,-47.09,3.31,-45.00,-44.95,-2.79,-44.97,-44.09,-16.33,-44.64,-47.97
  };

void setup() {
  // put your setup code here, to run once:
  Serial.begin(115200);
  Serial.println();
  Serial.println("16 channel Servo test!");
  
  pwm.begin();
  pwm1.begin();
  pwm.setPWMFreq(50);  // Analog servos run at ~50 Hz updates
  pwm1.setPWMFreq(50);  // Analog servos run at ~50 Hz updates
  
    for(int i=0;i<16;i++)
    {
      pwm.setPWM(i, 0, rec[i]);
      
    }
      pwm1.setPWM(0, 0, rec[16]);
      pwm1.setPWM(1, 0, rec[17]);
      ESP.wdtFeed();                    //喂狗防止复位
  delay(100);
  
  pinMode(led, OUTPUT);
  digitalWrite(led, 0);
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED)
  {
        delay(500);
  }
  server.begin();
  server.setNoDelay(true);  //加上后才正常些

}

void loop() {

    blink();
 
    uint8_t i;
    if (server.hasClient())
    {
        for (i = 0; i < MAX_SRV_CLIENTS; i++)
        {
            if (!serverClients[i] || !serverClients[i].connected())
            {
                if (serverClients[i]) serverClients[i].stop();//未联接,就释放
                serverClients[i] = server.available();//分配新的
                continue;
            }
 
        }
        WiFiClient serverClient = server.available();
        serverClient.stop();
    }
    for (i = 0; i < MAX_SRV_CLIENTS; i++)
    {
        if (serverClients[i] && serverClients[i].connected())
        {
            digitalWrite(led, 0);//有链接存在,就一直长亮
 
            if (serverClients[i].available())
            {
                while (serverClients[i].available()) 
                cmd = serverClients[i].read();
                delay(1);
                Serial.write(serverClients[i].read());
            }
        }
    }

    if(cmd == 'a')//前进
    {
      for(int j=0;j<120;j++)
      {
          for(int i=0;i<16;i++)
          {
            pwm.setPWM(i, 0, map(forwardF[j][i]*direct[i],-90,90,-225,225)+rec[i]);
            
          }
          pwm1.setPWM(16-16, 0, map(forwardF[j][16]*direct[16],-90,90,-225,225)+rec[16]);
          pwm1.setPWM(17-16, 0, map(forwardF[j][17]*direct[17],-90,90,-225,225)+rec[17]);
          ESP.wdtFeed();                    //喂狗防止复位
          delay(1);
      }
    }
    else if(cmd == 'b')//后退
    {
      for(int j=0;j<120;j++)
      {
          for(int i=0;i<16;i++)
          {
            pwm.setPWM(i, 0, map(forwardF[119-j][i]*direct[i],-90,90,-225,225)+rec[i]);
            
          }
          pwm1.setPWM(16-16, 0, map(forwardF[119-j][16]*direct[16],-90,90,-225,225)+rec[16]);
          pwm1.setPWM(17-16, 0, map(forwardF[119-j][17]*direct[17],-90,90,-225,225)+rec[17]);
          ESP.wdtFeed();                    //喂狗防止复位
          delay(1);
      }      
      
    }
    else if(cmd == 'c')
    {
      for(int j=0;j<120;j++)
      {
          for(int i=0;i<6;i++)
          {
            pwm.setPWM(i, 0, map(forwardF[j][i]*direct[i],-90,90,-225,225)+rec[i]);
            
          }
          for(int i=6;i<15;i++)
          {
            pwm.setPWM(i, 0, map(forwardF[119-j][i]*direct[i],-90,90,-225,225)+rec[i]);
            
          }
          pwm.setPWM(15, 0, map(forwardF[j][15]*direct[15],-90,90,-225,225)+rec[15]);
          pwm1.setPWM(16-16, 0, map(forwardF[j][16]*direct[16],-90,90,-225,225)+rec[16]);
          pwm1.setPWM(17-16, 0, map(forwardF[j][17]*direct[17],-90,90,-225,225)+rec[17]);
          
          ESP.wdtFeed();                    //喂狗防止复位
          delay(1);
      }
    }
    else if(cmd == 'd')
    {
      for(int j=0;j<120;j++)
      {
          for(int i=0;i<6;i++)
          {
            pwm.setPWM(i, 0, map(forwardF[119-j][i]*direct[i],-90,90,-225,225)+rec[i]);
            
          }
          for(int i=6;i<15;i++)
          {
            pwm.setPWM(i, 0, map(forwardF[j][i]*direct[i],-90,90,-225,225)+rec[i]);
            
          }
          pwm.setPWM(15, 0, map(forwardF[119-j][15]*direct[15],-90,90,-225,225)+rec[15]);
          pwm1.setPWM(16-16, 0, map(forwardF[119-j][16]*direct[16],-90,90,-225,225)+rec[16]);
          pwm1.setPWM(17-16, 0, map(forwardF[119-j][17]*direct[17],-90,90,-225,225)+rec[17]);
          
          ESP.wdtFeed();                    //喂狗防止复位
          delay(1);
      }
      
    }
    else
    {
      delay(100);
      ESP.wdtFeed();                    //喂狗防止复位
    }
    

}

void blink()
{
    static long previousMillis = 0;
    static int currstate = 0;
 
    if (millis() - previousMillis > 200)  //200ms
    {
        previousMillis = millis();
        currstate = 1 - currstate;
        digitalWrite(led, currstate);
    }
}
